\chapter{课题陈述}
\label{chp:2}

本文所要研究的金融问题是基于欧洲式期权的离散时间对冲策略的风险控制。欧式期权(European Option) 是期权的一种类型。另外两种期权类型是美式期权
(American Option)和亚洲期权(Asian Option)。期权本质上是一种金融合约，它授予期权的拥有者（买方）一种在某一特定时间点或之前，以某一个在合约中给出的价格
(strike price) 购买或者出售某一种金融产品(underlying asset) 的权利。买家在执行自己的权利时，卖家必须按照合约规定的价格进行交易，
但买家同时需要付给买家一定的额外交易手续费(premium)。期权的研究主要集中在对其价值的评估。期权的价值一般可以分为两个部分。一是期权的内部价值
(intrinsic value)，主要由该期权基于的金融产品在交易时的市场价格和合约定价的差值决定。二是期权的时间价值(Time Value)，这一部分取决于交易前的其他因素如
利息，增值等。期权的研究从19世纪就开始了，但目前的研究一般都是基于1973年提出的Black-Scholes模型。我们的课题也是基于Black-Scholes模型，并对欧式期权
对冲策略的风险控制进行研究。

\section{欧式期权} % (fold)
\label{sec:euroOption}

欧式期权的特点在于买方必须在合约规定的时间到期时才能行使权力。通常将欧式期权的合理价格价定为其期望价值。
相比与美式期权，二者在执行时间上有所不同。
美式期权合同在到期日前的任何时候或在到期日都可以执行合同，结算日则是在履约日之后的一天或两天，
大多数的美式期权合同允许持有者在交易日到履约日之间随时履约，但也有一些合同规定一段比较短的时间可以履约，如“到期日前两周”。
欧式期权合同要求其持有者只能在到期日履行合同，结算日是履约后的一天或两天。目前国内的外汇期权交易都是采用的欧式期权合同方式。
通过比较，结论是：欧式期权本少利大，但在获利的时间上不具灵活性；美式期权虽然灵活，但付费十分昂贵。因此，国际上大部分的期权交易都是欧式期权。
中国国内银行设立的外汇期权业务都是采用的欧式期权交易。

% section 欧式期权 (end)

\section{Black-Scholes模型} % (fold)
\label{sec:BlackScholes}

Black-Scholes 是一个70年代由Fischer Black和Myron Scholes 提出的用于金融衍生品交易的数学模型。这个模型可以推出Black-Scholes公式，
并用于预测欧式期权定价的理论值。70年代至今在众多的实际交易中，该公式的预测估值被认为是非常接近实际观测到的价值。
这个模型的成功也直接导致了期权交易市场的繁荣，并能使芝加哥期权交易市场等大的期权交易场所得到科学的有效的监管。
Black-Scholes 公式是一个偏微分方程，用于预测期权价格随时间的变化。而该模型背后的策略则是通过合理地买卖期权来对冲风险，这种对冲策略被
成为"Delta Hedging"，这也是许多更复杂的对冲机构策略的基础。此后Robert C. Merton 进一步发展了该模型，并和Schole分享了1997年的诺贝尔经济学奖。


% section Black-Scholes模型 (end)

\section{课题表述} % (fold)
\label{sec:subject}

本课题研究的对象就是欧式期权利用对冲策略来降低交易的风险。
我们考虑基于Black-Scholes模型的Delta 对冲策略，该策略为一个连续时间策略，也即策略所要求的交易行为发生在每时每刻，关于时间轴连续。
我们知道现实生活中，交易只能发生在一些离散的时间点上, 即交易员只能在一系列相继的时刻点上交易。
一个总所周知的事实是，实际中想要完美的复制实现一个给定的连续时间策略是不可能的。
本课题研究的就是离散时间版本的Delta 对冲策略与理论上的Delta 对冲策略之间的误差及风险控制。

在一般化的 Black-Scholes 模型中， 假设在时刻$t$, 期权所基于的风险资产价格为 $X_t$， 另外有一无风险资产价格为 $S_t^0$。
$X_t$ 满足如下的一维随机偏微分方程：
\begin{equation}
dX_t=\mu(X_t)X_tdt+\sigma(X_t)X_tdB_t,
\end{equation}
$X_0=x_0>0, \sigma(x)>0, \forall x>0$,
而无风险资产价格满足一个常微分方程：
\begin{equation}
dS_t^0=rS^0_tdt
\end{equation}。
我们引进一个新的随机过程$W_t$：
\begin{equation}
W_t=B_t+\int^t_0\frac{\mu(X_s)-r}{\sigma(X_s)}ds
\end{equation}，
在中性风险的概率空间下，这个随机过程是一个标准的布朗运动。 我们在此中性风险概率空间下考虑问题。
现在风险资产所满足的随机微分方程变为如下形式：
\begin{equation}
dX_t=rX_tdt+\sigma(X_t)X_tdW_t
\end{equation}
我们假设考虑的问题满足如下两个条件：

$(\mathcal{H}_1)$ $\mu$ 和 $\sigma$ 有限的, 两次连续可微且二次偏微分满足 H\"{o}lder 条件. 更准确的来说, 令 $\hat{\mu}(x)=\mu(exp(x))$， $\hat{\sigma}(x)=\sigma(exp(x))$, 且 $\delta\in (0,1)$， $K>0$, 对任意 $(x,x')\in \mathbb{R}^2$, 我们有：
$$|\hat{\mu}'(x)|+|\hat{\mu}''(x)|+\frac{|\hat{\mu}''(x)-\hat{\mu}''(x')|}{|x-x'|^\delta}+|\hat{\sigma}'(x)|+|\hat{\sigma}''(x)|+\frac{|\hat{\sigma}''(x)-\hat{\sigma''}(x')|}{|x-x'|^\delta}<K.$$ 

$(\mathcal{H}_2)$ 存在$\sigma_0>0$ 使得对任意 $x>0$ 有$|\sigma(x)|\geq \sigma_0$。

在这两个条件下
若欧洲期权的回报函数为 $f\in L^2(X_t)$, 则该期权在0 时刻的价格由下面公式给出：
\begin{equation}
h(f)(x_0)=\mathbb{E}(exp(-rT)f(X_T)|X_0=x_0).
\end{equation}
令
\begin{equation}
u(t, x)=\mathbb{E}(e^{-r(T-t)}f(X_{T-t}^x)),
\end{equation}
则$u$ 是如下方程的解：
\begin{equation}
-\frac{\partial}{\partial t}u(t, x) =\frac{1}{2}\sigma^2(x)x^2\frac{\partial^2}{\partial x^2}u(t,x)+rx\frac{\partial}{\partial x}u(t,x)-ru(t,x)
\end{equation}
这里 $(t,x)\in [0,T)\times (0,\infty)$ 且 $u(0,x)=h(f)$，  $u(T,x)=f(x)$。

一个广为人知的期权定价公式如下：
\begin{equation}
e^{-rT}f(X_T)=h(f)+\int_0^T \xi_t d\widetilde{X}_t
\end{equation}
这里 $\widetilde{X}_t=e^{-rT}X_t$ 是风险资产的折旧贴现价格。 
Ito's 公式给出了Delta 对冲策略$\xi$: 
\begin{equation}
\xi_t=\frac{\partial u}{\partial x}(t, X_t)
\end{equation}
换句话说，为了达到完美对冲，交易员需要在 
$t\in [0, T]$ 的时间内无时不刻的交易， 并且使自己在时刻 $t$ 持有恰好 $\xi_t$ 单位的风险资产。 
这在现实中是不可能达到的。

一个替代的解决方案是用在离散的时刻点交易的方法来逼近原先的对冲策略。假设交易员在$t\in[0, T)$
时间内交易$N$ 次，交易时间被定义为$t_k=kT/N$, $(k\in \{0,...,N\})$, 在 $t\in [t_k, t_{k+1})$时间内，
交易员使自己持有$\xi_{t_k}$单位的风险资产$X_t$。在此离散化策略的逼近下，在期权到期时刻$T$, 
完美对冲和离散化对冲的差值为：
\begin{equation}
\begin{split}
M_T^N
&=e^{-rT}f(X_T)-(u(0,x)+\int_0^T\frac{\partial u}{\partial x}(\varphi(t), 
X_{\varphi_t}))d\widetilde{X}_t\\
&=\int_0^T\frac{\partial u}{\partial x}(t, X_t)d\widetilde{X}_t-\int_0^T\frac{\    partial u}{\partial x}(\varphi(t), X_{\varphi(t)})d\widetilde{X}_t\\
&=(X_T-K)^+-\mathbb{E}[(X_T-K)^+]-\int_0^T\frac{\partial u}{\partial x}(\varphi(t), X_{\varphi(t)})dX_t\\
&=(X_T-K)^+-x_0N(d_1(0))+KN(d_2(0))-\sum_{i=0}^{n-1}N(d_1(t_i))(X_{t_{i+1}}-X_{t_i})\\
&=(X_T-K)^+-\frac{x_0}{\sqrt{2\pi}}\int_{-\infty}^{\frac{\log(\frac{x_0}{K})+\frac{1}{2}\sigma^2T}
{\sigma\sqrt{T}}}e^{-\frac{v^2}{2}}dv+\frac{K}{\sqrt{2\pi}}\int_{-\infty}^{\frac{\log(\frac{x_0}{K})-\frac{1}{2}\sigma^2T}{\sigma\sqrt{T}}}e^{-\frac{v^2}{2}}dv\\
&-\sum_{i=0}^{n-1}\frac{1}{\sqrt{2\pi}}\int_{-\infty}^{\frac{\log(\frac{X_{t_i}}{K})+\frac{1}{2}\sigma^2(T-t_i)}{\sigma\sqrt{T-t_i}}}e^{-\frac{v^2}{2}}dv(X_{t_{i+1}}-X_{t_i})\\
\end{split}
\end{equation}
这里 $\varphi(t)=sup\{t_i | t_i\leq t \}$.

对于该误差$M_T^N$，我们已知它有如下的渐进性质：
%\begin{Theorem}
$M_T^N$ 在概率上趋向于0:
\begin{equation}
M_T^N\xlongrightarrow[N\rightarrow +\infty]{\mathbb{P}}0
\end{equation}
%\end{Theorem}
See XXXXXX
%\begin{Theorem}

令 $X_t$ 随机偏微分方程 $dX_t=\sigma(X_t)X_tdW_t$ 的解所对应的随机过程, $u$ 如前文定义, 则我们有 
\begin{equation}
\sqrt{n}M_T^N\xlongrightarrow[N\rightarrow +\infty]{d} \hat{W}_\tau
\end{equation}
这里 $\tau=\frac{1}{2}\int_0^T(\frac{\partial^2 u}{\partial x^2}(t,X_t))^2\sigma^4(X_t)X_t^4dt$, 且 $\hat{W}$ 是一个独立于 $\tau$另一个布朗运动.
%\end{Theorem}

See XXXXXX

上面的两条渐进性质不仅告诉我们随着 $N$的增大，离散对冲策略的逼近将越来越成功，两者相差的误差将在概率意义下趋于零，而且还告诉我们此误差的渐进表现
类似于一个系数逐渐变小的布朗运动。特别的，我们从中可知，通过增大 $N$, 在概率意义下，离散化的Delta 对冲策略可以任意程度的逼近完美Delta 对冲策略。

由于实际交易中交易成本一类的问题，所以在一定的交易风险范围内，我们希望能够用最少的交易次数来完成既定的交易策略。
也即我们希望找到一个最小的交易次数$N$来最优化交易成本。
假设在$t=T$时，交易的误差可表示为$|P(X) - P_{T_N}(X)|$, 而可接受的最大误差为$\epsilon$，我们将采用蒙特卡洛模拟算法，通过$M$次模拟，计算出
$|P(X) - P_{T_N}(X)| < \epsilon$的概率$Prob(M,N)$, 当$Prob(M,N)$的值大于一个预先设定的概率值时，我们认为$N$是一个可接受的抽样次数。
算法\ref{alg:bserror} 给出了我们计算验证一个$N$值的串行算法伪代码。

\begin{algorithm}
  \caption{欧式期权对冲策略误差控制的串行算法}
  \label{alg:bserror}
	\begin{algorithmic}[1]
	 \Require $X0$ \Comment{金融产品在$t=0$时的初始价格}
	 \Require $\sigma$ \Comment{市场波动性}
	 \Require $K$ \Comment{期权合约价格}
	 \Require $T$ \Comment{期权到期时间}
	 \Require $\epsilon$ \Comment{可接受的误差上限}
	 \Require $Prob$ \Comment{离散策略误差可接受概率下限}
         \Require $N_{0}$ \Comment{理论给出的初始离散抽样次数上界}
         \Require $M$ \Comment{蒙特卡洛模拟次数}
	 \Procedure{BSERROR}{}
         \State $error \gets 0$ \Comment{离散策略和连续策略的误差}
         \State $NRV[N]$ \Comment{符合正态分布的N个独立随机数}
         \State $BM[N]$ \Comment{布朗运动的N个状态}
         \State $PX[N+1]$ \Comment{在离散时间点的期权价格}
	 \State $\delta t \gets T/N$ \Comment{时间间隔}
	 \State $count \gets 0$ \Comment{在$M$次模拟中$N$被接受的次数}
         \State $N \gets N_0$
	  \ForAll{$m=1:M$} \Comment{M次蒙特卡洛模拟}
          \State $error \gets 0$ \Comment{离散策略和连续策略的误差}
	  \For {all $NRV[j]$}
	     $NRV[j] \gets GaussianNumGenerator()$
	  \EndFor
	  \State $BM[0] \gets NRV[0] \cdot \sqrt{\delta t}$ 
	  \For {all $BM[j]$}
	     $BM[j] \gets BM[j-1] + NRV[j]\cdot \sqrt{\delta t}$ 
	  \EndFor
	  \State $PX[0] \gets X0$
	  \ForAll {$j= 1:N+1$}
	  \State $PX[j]\gets X0 \cdot exp(-0.5\cdot \sigma^2 \cdot j \cdot \delta t + \sigma \cdot BM[j-1])$
	  \EndFor
	  \ForAll{$j=0:N-1$}
	  \State $Upper \gets (\log(PX[j]/K) + 0.5\cdot \sigma^2 \cdot (T- T_j))/ (\sigma \cdot \sqrt{T-T_j})$ 
	  \State $error \gets error - 1/(\sqrt{2\pi}) \cdot (PX[j+1]-PX[j])\cdot \int_{-\infty}^{Upper}e^{-t^2/2}dt $
	  \EndFor

	  \If {$PX[N] > K$} 
	  \State $error \gets error + (PX[N]-K)$
	  \EndIf

	  \State $Upper1 \gets (log(X0/K) + 0.5\cdot \sigma^2 \cdot T)/(\sigma \sqrt{T})$
	  \State $Upper2 \gets (log(X0/K) - 0.5\cdot \sigma^2 \cdot T)/(\sigma \sqrt{T})$
	  \State $error = error + K/(\sqrt{2\pi} \cdot \int_{-\infty}^{Upper2}e^{-t^2/2}dt -X0/(\sqrt{2\pi})\cdot \int_{-\infty}^{Upper1}e^{-t^2/2}dt$
	  
	  \If {$error < \epsilon$} 
	  \State $count \gets count + 1$ 
	  \EndIf
	  \EndFor

	  \State $prob \gets count/M$
	  \If{$prob < Prob$}
	  \State $N \gets N + 1$
	  \Else
	  \State $N \gets N - 1$
	  \EndIf

	  \State return $N$
	 \EndProcedure
  \end{algorithmic}
\end{algorithm}


% section 课题表述 (end)

%\section{BSERROR算法的并行化} % (fold)
%\label{sec:BSERRORParallel}



% section BSERROR算法的并行化 (end)
